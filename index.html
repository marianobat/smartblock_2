<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SmartBlock – Blockly + Arduino</title>
    <style>
      html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
      header { display:flex; align-items:center; justify-content:space-between; padding: 10px 16px; border-bottom: 1px solid #eee; }
      header .left { display:flex; gap:12px; align-items:center; }
      header .right { display:flex; gap:8px; align-items:center; }
      button { padding:8px 12px; border:1px solid #ddd; border-radius:8px; background:#fff; cursor:pointer; }
      button.primary { background:#0ea5e9; color:white; border-color:#0ea5e9; }
      #wrap { display:grid; grid-template-columns: 1fr 420px; height: calc(100% - 56px); }
      #blocklyArea { position: relative; }
      #blocklyDiv { position: absolute; inset: 0; }
      #side { display:flex; flex-direction:column; border-left:1px solid #eee; }
      #code { flex:1; padding:8px; box-sizing:border-box; }
      #status { padding:8px 12px; font-size:12px; border-top:1px dashed #eee; color:#555; }
      textarea { width:100%; height:100%; resize:none; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px; }
      .badge { padding:2px 6px; border-radius:999px; font-size:11px; border:1px solid #ddd; }
      .ok { color:#047857; border-color:#047857; }
      .warn { color:#b45309; border-color:#b45309; }
      .err { color:#b91c1c; border-color:#b91c1c; }
      .muted { color:#6b7280; }
    </style>
    <!-- Blockly from CDN -->
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
  </head>
  <body>
    <header>
      <div class="left">
        <strong>SmartBlock</strong>
        <span class="badge muted">Starter</span>
      </div>
      <div class="right">
        <button id="btnCopy">Copiar código</button>
        <button id="btnDownload">Descargar .ino</button>
        <button id="btnDetectAgent">Detectar Agente</button>
        <button id="btnUpload" class="primary">Subir a placa (Agente)</button>
      </div>
    </header>

    <div id="wrap">
      <div id="blocklyArea">
        <div id="blocklyDiv"></div>
      </div>
      <div id="side">
        <div id="code">
          <textarea id="out" spellcheck="false"></textarea>
        </div>
        <div id="status">
          <div><strong>Estado:</strong> <span id="agentState" class="badge warn">Agente no detectado</span></div>
          <div id="agentInfo" class="muted" style="margin-top:4px;">Edita tu <code>config.ini</code> y agrega <code>origins = https://TU_DOMINIO_VERSEL.app, http://localhost:5173</code>, reinicia el Agente de Arduino y pulsa “Detectar Agente”.</div>
        </div>
      </div>
    </div>

    <!-- Toolbox (XML embebido) -->
    <xml id="toolbox" style="display:none">
      <category name="Básicos" colour="#0ea5e9">
        <block type="setup_block"></block>
        <block type="loop_block"></block>
        <block type="delay_ms"></block>
      </category>
      <category name="Digital" colour="#22c55e">
        <block type="digital_write">
          <value name="PIN"><shadow type="math_number"><field name="NUM">13</field></shadow></value>
          <value name="VAL"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow></value>
        </block>
        <block type="pin_mode">
          <value name="PIN"><shadow type="math_number"><field name="NUM">13</field></shadow></value>
          <value name="MODE"><shadow type="text"><field name="TEXT">OUTPUT</field></shadow></value>
        </block>
      </category>
      <category name="Analógicos" colour="#eab308">
        <block type="analog_read">
          <value name="PIN"><shadow type="text"><field name="TEXT">A0</field></shadow></value>
        </block>
      </category>
      <category name="Variables" custom="VARIABLE" colour="#a78bfa"></category>
      <category name="Lógica" colour="#60a5fa">
        <block type="controls_if"></block>
        <block type="logic_compare"></block>
        <block type="logic_boolean"></block>
      </category>
      <category name="Matemática" colour="#f472b6">
        <block type="math_number"></block>
        <block type="math_arithmetic"></block>
      </category>
    </xml>

    <script type="module" src="./js/blocks.js"></script>
    <script type="module" src="./js/generator.js"></script>
    <script type="module" src="./js/agent.js"></script>
    <script type="module" src="./js/app.js"></script>
  </body>
</html>
